function liquidFillGaugeDefaultSettings(){return{minValue:0,maxValue:100,circleThickness:.05,circleFillGap:.05,circleColor:"#178BCA",circleFill:"#fff",waveHeight:.05,waveCount:1,waveRiseTime:1e3,waveAnimateTime:18e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.5,textSize:1,valueCountUp:!0,displayPercent:!0,textColor:"#045681",waveTextColor:"#A4DBf8"}}function loadLiquidFillGauge(elementId,value,config){null==config&&(config=liquidFillGaugeDefaultSettings());var gauge=d3.select("#"+elementId),radius=Math.min(parseInt(gauge.style("width")),parseInt(gauge.style("height")))/2,locationX=parseInt(gauge.style("width"))/2-radius,locationY=parseInt(gauge.style("height"))/2-radius,fillPercent=Math.max(config.minValue,Math.min(config.maxValue,value))/config.maxValue,waveHeightScale;waveHeightScale=config.waveHeightScaling?d3.scaleLinear().range([0,config.waveHeight,0]).domain([0,50,100]):d3.scaleLinear().range([config.waveHeight,config.waveHeight]).domain([0,100]);var textPixels=config.textSize*radius/2,textFinalValue=parseFloat(value).toFixed(2),textStartValue=config.valueCountUp?config.minValue:textFinalValue,percentText=config.displayPercent?"%":"",circleThickness=config.circleThickness*radius,circleFillGap,fillCircleMargin=circleThickness+config.circleFillGap*radius,fillCircleRadius=radius-fillCircleMargin,waveHeight=fillCircleRadius*waveHeightScale(100*fillPercent),waveLength=2*fillCircleRadius/config.waveCount,waveClipCount=1+config.waveCount,waveClipWidth=waveLength*waveClipCount,textRounder=function(value){return Math.round(value)};parseFloat(textFinalValue)!=parseFloat(textRounder(textFinalValue))&&(textRounder=function(value){return parseFloat(value).toFixed(1)}),parseFloat(textFinalValue)!=parseFloat(textRounder(textFinalValue))&&(textRounder=function(value){return parseFloat(value).toFixed(2)});for(var data=[],i=0;i<=40*waveClipCount;i++)data.push({x:i/(40*waveClipCount),y:i/40});var gaugeCircleX=d3.scaleLinear().range([0,2*Math.PI]).domain([0,1]),gaugeCircleY=d3.scaleLinear().range([0,radius]).domain([0,radius]),waveScaleX=d3.scaleLinear().range([0,waveClipWidth]).domain([0,1]),waveScaleY=d3.scaleLinear().range([0,waveHeight]).domain([0,1]),waveRiseScale=d3.scaleLinear().range([fillCircleMargin+2*fillCircleRadius+waveHeight,fillCircleMargin-waveHeight]).domain([0,1]),waveAnimateScale=d3.scaleLinear().range([0,waveClipWidth-2*fillCircleRadius]).domain([0,1]),textRiseScaleY=d3.scaleLinear().range([fillCircleMargin+2*fillCircleRadius,fillCircleMargin+.7*textPixels]).domain([0,1]),gaugeGroup=gauge.append("g").attr("transform","translate("+locationX+","+locationY+")");gaugeGroup.append("circle").attr("cx",radius).attr("cy",radius).attr("r",radius).attr("class","fill").style("fill",config.circleFill);var gaugeStrokeArc=d3.arc().startAngle(gaugeCircleX(0)).endAngle(gaugeCircleX(1)).outerRadius(gaugeCircleY(radius)).innerRadius(gaugeCircleY(radius-circleThickness));gaugeGroup.append("path").attr("d",gaugeStrokeArc).attr("class","stroke").style("fill",config.circleColor).attr("transform","translate("+radius+","+radius+")");var text1=gaugeGroup.append("text").text(textRounder(textStartValue)+percentText).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",textPixels+"px").style("fill",config.textColor).attr("transform","translate("+radius+","+textRiseScaleY(config.textVertPosition)+")"),clipArea=d3.area().x(function(d){return waveScaleX(d.x)}).y0(function(d){return waveScaleY(Math.sin(2*Math.PI*config.waveOffset*-1+2*Math.PI*(1-config.waveCount)+2*d.y*Math.PI))}).y1(function(d){return 2*fillCircleRadius+waveHeight}),waveGroup=gaugeGroup.append("defs").append("clipPath").attr("id","clipWave"+elementId),wave=waveGroup.append("path").datum(data).attr("d",clipArea).attr("T",0),fillCircleGroup=gaugeGroup.append("g").attr("clip-path","url(#clipWave"+elementId+")");fillCircleGroup.append("circle").attr("cx",radius).attr("cy",radius).attr("r",fillCircleRadius).style("fill",config.waveColor);var text2=fillCircleGroup.append("text").text(textRounder(textStartValue)+percentText).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",textPixels+"px").style("fill",config.waveTextColor).attr("transform","translate("+radius+","+textRiseScaleY(config.textVertPosition)+")");if(config.valueCountUp){var textTween=function(){var i=d3.interpolate(this.textContent,textFinalValue),myText=d3.select(this);return function(t){myText.text(textRounder(i(t))+percentText)}};text1.transition().duration(config.waveRiseTime).tween("text",textTween),text2.transition().duration(config.waveRiseTime).tween("text",textTween)}var waveGroupXPosition=fillCircleMargin+2*fillCircleRadius-waveClipWidth;function animateWave(){wave.attr("transform","translate("+waveAnimateScale(wave.attr("T"))+",0)"),wave.transition().duration(config.waveAnimateTime*(1-wave.attr("T"))).ease(d3.easeLinear).attr("transform","translate("+waveAnimateScale(1)+",0)").attr("T",1).on("end",function(){wave.attr("T",0),animateWave(config.waveAnimateTime)})}function GaugeUpdater(){this.update=function(value){var newFinalValue=parseFloat(value).toFixed(2),textRounderUpdater=function(value){return Math.round(value)};parseFloat(newFinalValue)!=parseFloat(textRounderUpdater(newFinalValue))&&(textRounderUpdater=function(value){return parseFloat(value).toFixed(1)}),parseFloat(newFinalValue)!=parseFloat(textRounderUpdater(newFinalValue))&&(textRounderUpdater=function(value){return parseFloat(value).toFixed(2)});var textTween=function(){var i=d3.interpolate(this.textContent,parseFloat(value).toFixed(2)),myText=d3.select(this);return function(t){myText.text(textRounder(i(t))+percentText)}};text1.transition().duration(config.waveRiseTime).tween("text",textTween),text2.transition().duration(config.waveRiseTime).tween("text",textTween);var fillPercent=Math.max(config.minValue,Math.min(config.maxValue,value))/config.maxValue,waveHeight=fillCircleRadius*waveHeightScale(100*fillPercent),waveRiseScale,newHeight=d3.scaleLinear().range([fillCircleMargin+2*fillCircleRadius+waveHeight,fillCircleMargin-waveHeight]).domain([0,1])(fillPercent),waveScaleX=d3.scaleLinear().range([0,waveClipWidth]).domain([0,1]),waveScaleY=d3.scaleLinear().range([0,waveHeight]).domain([0,1]),newClipArea;newClipArea=config.waveHeightScaling?d3.area().x(function(d){return waveScaleX(d.x)}).y0(function(d){return waveScaleY(Math.sin(2*Math.PI*config.waveOffset*-1+2*Math.PI*(1-config.waveCount)+2*d.y*Math.PI))}).y1(function(d){return 2*fillCircleRadius+waveHeight}):clipArea;var newWavePosition=config.waveAnimate?waveAnimateScale(1):0;wave.transition().duration(0).transition().duration(config.waveAnimate?config.waveAnimateTime*(1-wave.attr("T")):config.waveRiseTime).ease(d3.easeLinear).attr("d",newClipArea).attr("transform","translate("+newWavePosition+",0)").attr("T","1").on("end",function(){config.waveAnimate&&(wave.attr("transform","translate("+waveAnimateScale(0)+",0)"),animateWave(config.waveAnimateTime))}),waveGroup.transition().duration(config.waveRiseTime).attr("transform","translate("+waveGroupXPosition+","+newHeight+")")}}return config.waveRise?waveGroup.attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(0)+")").transition().duration(config.waveRiseTime).attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(fillPercent)+")").on("start",function(){wave.attr("transform","translate(1,0)")}):waveGroup.attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(fillPercent)+")"),config.waveAnimate&&animateWave(),new GaugeUpdater}